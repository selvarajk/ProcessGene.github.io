<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Cost-Benefit Analyzer for test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .input-group {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen">

    <div class="max-w-6xl mx-auto bg-white shadow-2xl rounded-xl p-6 md:p-10">

        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-indigo-700">Cost-Benefit Analyzer: <span id="productNameDisplay">Your Product</span></h1>
            <p class="text-gray-500 mt-2">Evaluate the financial viability of a project or product launch (Currency: INR).</p>
        </header>

        <!-- Product Name Input -->
        <div class="mb-8">
            <label for="productName" class="block text-sm font-medium text-gray-700 mb-2">Product/Project Name</label>
            <input type="text" id="productName" value="New AI Tool Deployment" oninput="updateProductName()" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 1. Cost Inputs -->
            <section class="lg:col-span-2 bg-indigo-50 p-6 rounded-xl border border-indigo-200">
                <h2 class="text-2xl font-semibold text-indigo-800 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8v4m0 4v4m-3.297-5.187A11.955 11.955 0 0112 10.517v4.364m-3.297-5.187L12 10.517m0-4.364l-3.297 5.187M12 10.517l3.297 5.187m-3.297-5.187L12 10.517m0-4.364l-3.297 5.187"></path></svg>
                    Costs & Investment (All figures in INR)
                </h2>

                <!-- One-Time Costs -->
                <div class="mb-6 border-b pb-4">
                    <h3 class="text-xl font-medium text-gray-800 mb-3">One-Time Costs (Initial Investment - Year 0)</h3>
                    
                    <!-- Development Period -->
                    <div class="input-group bg-white p-3 rounded-lg border-l-4 border-indigo-500 mb-4">
                        <label for="development_months" class="block text-sm font-bold text-indigo-700">Development Period (Months: 1-12)</label>
                        <input type="number" id="development_months" value="6" min="1" max="12" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>

                    <div class="input-group">
                        <label for="cost_initial_dev" class="text-sm text-gray-600">Dev & Setup (Non-Staff)</label>
                        <input type="number" id="cost_initial_dev" value="500000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>
                    
                    <div class="input-group">
                        <label for="cost_training" class="text-sm text-gray-600">Initial Training & Documentation</label>
                        <input type="number" id="cost_training" value="50000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>

                    <h4 class="font-semibold text-sm text-indigo-700 mt-4 mb-2">FTE Development Cost (Annual Input, Prorated by Months)</h4>
                    <div class="input-group ml-4">
                        <label for="cost_fte_salary" class="text-sm text-gray-600">FTE Salary Component (Input Annual Cost)</label>
                        <input type="number" id="cost_fte_salary" value="1200000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>
                    <div class="input-group ml-4">
                        <label for="cost_fte_seat" class="text-sm text-gray-600">FTE Seat/Overhead Cost (Input Annual Cost)</label>
                        <input type="number" id="cost_fte_seat" value="100000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>

                    <h4 class="font-semibold text-sm text-indigo-700 mt-4 mb-2">Infrastructure Cost (Initial)</h4>
                    <div class="input-group ml-4">
                        <label for="cost_infra_dev" class="text-sm text-gray-600">Infrastructure Cost (Development/Testing)</label>
                        <input type="number" id="cost_infra_dev" value="150000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>
                </div>

                <!-- Recurring Annual Costs -->
                <div>
                    <h3 class="text-xl font-medium text-gray-800 mb-3">Recurring Annual Costs (Year 1 onwards)</h3>
                    
                    <div class="input-group">
                        <label for="cost_annual_maintenance" class="text-sm text-gray-600">Software Licensing (Annual)</label>
                        <input type="number" id="cost_annual_maintenance" value="200000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>
                    
                    <div class="input-group">
                        <label for="cost_staffing" class="text-sm text-gray-600">Project Manager/Misc. Staffing</label>
                        <input type="number" id="cost_staffing" value="300000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>

                    <h4 class="font-semibold text-sm text-indigo-700 mt-4 mb-2">Operational Costs (Annual)</h4>
                    <div class="input-group ml-4">
                        <label for="cost_infra_golive" class="text-sm text-gray-600">Infrastructure Cost (Post Go-Live / Production)</label>
                        <input type="number" id="cost_infra_golive" value="300000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>
                    <div class="input-group ml-4">
                        <label for="cost_token" class="text-sm text-gray-600">Token/Usage Cost (Generative AI, Annual)</label>
                        <input type="number" id="cost_token" value="50000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>
                    <div class="input-group ml-4">
                        <label for="cost_aws_ops" class="text-sm text-gray-600">AWS Ops Engineer (Annual Salary)</label>
                        <input type="number" id="cost_aws_ops" value="800000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>
                </div>
            </section>

            <!-- 2. Benefit Inputs -->
            <section class="lg:col-span-1 bg-green-50 p-6 rounded-xl border border-green-200">
                <h2 class="text-2xl font-semibold text-green-800 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                    Quantifiable Benefits (Annual)
                </h2>

                <div class="input-group">
                    <label for="benefit_revenue" class="text-sm text-gray-600">Increased Annual Revenue / Sales Lift</label>
                    <input type="number" id="benefit_revenue" value="1500000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                </div>
                
                <!-- NEW: Retained ARR -->
                <div class="input-group">
                    <label for="benefit_arr" class="text-sm text-gray-600">Retained Annual Recurring Revenue (ARR)</label>
                    <input type="number" id="benefit_arr" value="0" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                </div>
                
                <!-- NEW: Operational Efficiency -->
                <div class="input-group">
                    <label for="benefit_efficiency" class="text-sm text-gray-600">Operational Efficiency Gains (Monetary Value)</label>
                    <input type="number" id="benefit_efficiency" value="0" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                </div>

                <!-- NEW: Future Revenue Projections -->
                <div class="input-group">
                    <label for="benefit_future_revenue" class="text-sm text-gray-600">Future Revenue Projections (Annualized)</label>
                    <input type="number" id="benefit_future_revenue" value="0" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                </div>

                <div class="input-group">
                    <label for="benefit_savings" class="text-sm text-gray-600">Operational Cost Savings (e.g., reduced errors)</label>
                    <input type="number" id="benefit_savings" value="400000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                </div>
                <div class="input-group">
                    <label for="benefit_productivity" class="text-sm text-gray-600">Productivity Gains (Monetized time savings)</label>
                    <input type="number" id="benefit_productivity" value="500000" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                </div>

                <div class="mt-8 border-t pt-4">
                    <h3 class="text-xl font-medium text-gray-800 mb-3">Analysis Parameters</h3>
                    <div class="input-group">
                        <label for="analysis_period" class="text-sm text-gray-600">Analysis Period (Years)</label>
                        <input type="number" id="analysis_period" value="5" min="1" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>
                    <div class="input-group">
                        <label for="discount_rate" class="text-sm text-gray-600">Discount Rate (%) for NPV</label>
                        <input type="number" id="discount_rate" value="10" min="0" max="100" oninput="calculateCBA()" class="w-full p-2 border rounded-md mt-1">
                    </div>
                </div>
            </section>
        </div>
<div>
    <script
  src="https://cdn.jsdelivr.net/gh/logspace-ai/langflow-embedded-chat@v1.0.7/dist/build/static/js/bundle.min.js">
</script>
  <langflow-chat
    window_title="Compliance Gene"
    flow_id="86db66c8-79cc-4086-9adc-a052993e7ec3"
    host_url="http://localhost:7860">
</langflow-chat>
</div>
        <!-- 3. Results Section -->
        <section class="mt-10 p-6 bg-gray-50 rounded-xl shadow-lg border-t-4 border-indigo-500">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Financial Analysis Results</h2>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Total Costs -->
                <div class="bg-red-50 p-4 rounded-lg text-center shadow-md">
                    <p class="text-sm font-medium text-red-600">Total Project Costs</p>
                    <p id="totalCost" class="text-3xl font-extrabold text-red-800 mt-1">₹0</p>
                    <p class="text-xs text-gray-500">(Initial + Annualized)</p>
                </div>

                <!-- Total Benefits -->
                <div class="bg-green-50 p-4 rounded-lg text-center shadow-md">
                    <p class="text-sm font-medium text-green-600">Total Project Benefits</p>
                    <p id="totalBenefit" class="text-3xl font-extrabold text-green-800 mt-1">₹0</p>
                    <p class="text-xs text-gray-500">(Over Analysis Period)</p>
                </div>

                <!-- ROI -->
                <div class="bg-yellow-50 p-4 rounded-lg text-center shadow-md">
                    <p class="text-sm font-medium text-yellow-600">Return on Investment (ROI)</p>
                    <p id="roi" class="text-3xl font-extrabold text-yellow-800 mt-1">0%</p>
                    <p class="text-xs text-gray-500">(Benefit-Cost) / Cost</p>
                </div>

                <!-- NPV -->
                <div class="p-4 rounded-lg text-center shadow-md" id="npvBox">
                    <p class="text-sm font-medium text-blue-600">Net Present Value (NPV)</p>
                    <p id="npv" class="text-3xl font-extrabold text-blue-800 mt-1">₹0</p>
                    <p class="text-xs text-gray-500">(@ <span id="npvDiscountRate">10%</span> Discount Rate)</p>
                </div>
            </div>

            <!-- Conclusion Message -->
            <div id="conclusionMessage" class="mt-8 p-4 rounded-lg text-center font-semibold transition-colors duration-300">
                <p>Enter your financial data above to see the analysis.</p>
            </div>
        </section>

        <!-- Detailed Cash Flow Table -->
        <section class="mt-10">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Detailed Cash Flow Projections</h2>
            <div class="overflow-x-auto rounded-lg shadow-md">
                <table class="min-w-full bg-white border-collapse">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="p-3 text-left text-sm font-semibold text-gray-600">Year</th>
                            <th class="p-3 text-right text-sm font-semibold text-gray-600">Annual Benefit</th>
                            <th class="p-3 text-right text-sm font-semibold text-gray-600">Annual Cost</th>
                            <th class="p-3 text-right text-sm font-semibold text-gray-600">Net Cash Flow</th>
                            <th class="p-3 text-right text-sm font-semibold text-gray-600">Discount Factor</th>
                            <th class="p-3 text-right text-sm font-semibold text-gray-600 bg-indigo-100 rounded-tr-lg">Present Value</th>
                        </tr>
                    </thead>
                    <tbody id="cashFlowTableBody" class="divide-y divide-gray-200">
                        <!-- Rows populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

    </div>

    <script>
        // Global utility function for currency formatting (Updated to INR)
        const formatter = new Intl.NumberFormat('en-IN', {
            style: 'currency',
            currency: 'INR',
            minimumFractionDigits: 0,
            maximumFractionDigits: 2,
        });

        // --- Helper Functions ---

        /**
         * Parses input value as a number, defaulting to 0 if invalid.
         * @param {string} id - The ID of the input element.
         * @returns {number} The parsed number.
         */
        const getInputValue = (id) => {
            const element = document.getElementById(id);
            const value = parseFloat(element.value);
            return isNaN(value) || value < 0 ? 0 : value;
        };

        /**
         * Calculates the Discount Factor for a given year and rate.
         * @param {number} year - The cash flow year (starting from 0).
         * @param {number} rate - The discount rate (as a decimal).
         * @returns {number} The discount factor.
         */
        const calculateDiscountFactor = (year, rate) => {
            if (year === 0) return 1; // Year 0 (initial investment) is always 1
            return 1 / Math.pow(1 + rate, year);
        };

        // --- Main Calculation Logic ---

        const calculateCBA = () => {
            // 1. Get Inputs and Parameters
            
            const developmentMonths = getInputValue('development_months');
            // Proration factor ensures only costs for the development duration are included in Year 0.
            const prorationFactor = developmentMonths > 0 && developmentMonths <= 12 ? developmentMonths / 12 : 1;

            // FTE costs are annual inputs that need to be prorated for the development period.
            const fteSalary = getInputValue('cost_fte_salary');
            const fteSeat = getInputValue('cost_fte_seat');

            const proratedFteCost = (fteSalary + fteSeat) * prorationFactor;


            // ------------------------------------
            // ONE-TIME COSTS (Year 0)
            // ------------------------------------
            const oneTimeCost = getInputValue('cost_initial_dev') + 
                                getInputValue('cost_training') + 
                                proratedFteCost + // Use prorated amount
                                getInputValue('cost_infra_dev');

            // ------------------------------------
            // RECURRING ANNUAL COSTS (Year 1 onwards)
            // ------------------------------------
            const annualRecurringCost = getInputValue('cost_annual_maintenance') + 
                                        getInputValue('cost_staffing') +
                                        getInputValue('cost_infra_golive') +
                                        getInputValue('cost_token') +
                                        getInputValue('cost_aws_ops');

            // ANNUAL BENEFIT CALCULATION (Updated to include new fields)
            const annualBenefit = getInputValue('benefit_revenue') + 
                                  getInputValue('benefit_arr') + // NEW
                                  getInputValue('benefit_efficiency') + // NEW
                                  getInputValue('benefit_future_revenue') + // NEW
                                  getInputValue('benefit_savings') + 
                                  getInputValue('benefit_productivity');


            const analysisPeriod = Math.floor(getInputValue('analysis_period'));
            const discountRatePercent = getInputValue('discount_rate');
            const discountRate = discountRatePercent / 100;
            
            // Update discount rate display for NPV
            document.getElementById('npvDiscountRate').textContent = `${discountRatePercent}%`;
            
            // Ensure analysis period is at least 1
            const years = analysisPeriod > 0 ? analysisPeriod : 1;
            
            // 2. Calculate Cash Flow for NPV/ROI
            const cashFlows = [];
            let totalDiscountedCF = 0;
            let totalLifetimeBenefit = 0;
            let totalLifetimeCost = oneTimeCost; // Starts with Year 0 cost

            // Year 0: Initial Investment (Cost is negative)
            const year0CF = -oneTimeCost;
            cashFlows.push({
                year: 0,
                annualBenefit: 0,
                annualCost: oneTimeCost,
                netCF: year0CF,
                discountFactor: 1,
                presentValue: year0CF
            });
            totalDiscountedCF += year0CF;

            // Years 1 to N: Annual Costs and Benefits
            for (let y = 1; y <= years; y++) {
                const netCF = annualBenefit - annualRecurringCost;
                const discountFactor = calculateDiscountFactor(y, discountRate);
                const presentValue = netCF * discountFactor;

                totalLifetimeBenefit += annualBenefit;
                totalLifetimeCost += annualRecurringCost; // Add full annual recurring cost
                totalDiscountedCF += presentValue;
                
                cashFlows.push({
                    year: y,
                    annualBenefit: annualBenefit,
                    annualCost: annualRecurringCost,
                    netCF: netCF,
                    discountFactor: discountFactor,
                    presentValue: presentValue
                });
            }

            // 3. Calculate Final Metrics
            const totalProjectCost = totalLifetimeCost; // Sum of all costs including initial
            const totalProjectBenefit = totalLifetimeBenefit; // Sum of all benefits

            let roiValue = 0;
            // ROI = (Total Benefits - Total Costs) / Total Costs
            if (totalProjectCost > 0) {
                roiValue = ((totalProjectBenefit - totalProjectCost) / totalProjectCost) * 100;
            }

            const npvValue = totalDiscountedCF;

            // 4. Update UI
            updateResultsDisplay(totalProjectCost, totalProjectBenefit, roiValue, npvValue);
            updateCashFlowTable(cashFlows);
            updateConclusionMessage(roiValue, npvValue);
        };

        // --- UI Update Logic ---

        const updateProductName = () => {
            const name = document.getElementById('productName').value || 'Your Product';
            document.getElementById('productNameDisplay').textContent = name;
            calculateCBA(); // Recalculate if the name changes (for fresh start feel)
        };

        const updateResultsDisplay = (totalCost, totalBenefit, roi, npv) => {
            document.getElementById('totalCost').textContent = formatter.format(totalCost);
            document.getElementById('totalBenefit').textContent = formatter.format(totalBenefit);
            
            // Format ROI
            const roiText = `${roi.toFixed(1)}%`;
            document.getElementById('roi').textContent = roiText;

            // Format NPV
            document.getElementById('npv').textContent = formatter.format(npv);

            // Conditional styling for NPV box
            const npvBox = document.getElementById('npvBox');
            if (npv >= 0) {
                npvBox.className = 'p-4 rounded-lg text-center shadow-md bg-blue-100';
            } else {
                npvBox.className = 'p-4 rounded-lg text-center shadow-md bg-red-100';
            }
        };

        const updateCashFlowTable = (cashFlows) => {
            const tableBody = document.getElementById('cashFlowTableBody');
            tableBody.innerHTML = '';

            cashFlows.forEach(cf => {
                const isInitialYear = cf.year === 0;
                const netCFClass = cf.netCF >= 0 ? 'text-green-600 font-medium' : 'text-red-600 font-medium';
                const presentValueClass = cf.presentValue >= 0 ? 'text-indigo-700 font-extrabold' : 'text-red-700 font-extrabold';
                
                const row = document.createElement('tr');
                row.className = isInitialYear ? 'bg-gray-100 border-t-2 border-gray-300' : 'hover:bg-gray-50';

                row.innerHTML = `
                    <td class="p-3 text-left text-sm font-bold">${isInitialYear ? 'Initial (Year 0)' : `Year ${cf.year}`}</td>
                    <td class="p-3 text-right text-sm">${isInitialYear ? '-' : formatter.format(cf.annualBenefit)}</td>
                    <td class="p-3 text-right text-sm">${formatter.format(cf.annualCost)}</td>
                    <td class="p-3 text-right text-sm ${netCFClass}">${formatter.format(cf.netCF)}</td>
                    <td class="p-3 text-right text-sm">${cf.discountFactor.toFixed(3)}</td>
                    <td class="p-3 text-right text-sm ${presentValueClass} bg-indigo-50">${formatter.format(cf.presentValue)}</td>
                `;
                tableBody.appendChild(row);
            });
        };

        const updateConclusionMessage = (roi, npv) => {
            const messageBox = document.getElementById('conclusionMessage');
            let message = '';
            let boxClass = 'mt-8 p-4 rounded-lg text-center font-semibold ';

            if (npv > 0) {
                message = `The analysis shows a positive NPV of ${formatter.format(npv)} and an ROI of ${roi.toFixed(1)}%. This project is financially viable and recommended!`;
                boxClass += 'bg-green-100 text-green-700 border border-green-300';
            } else if (npv < 0) {
                message = `The analysis indicates a negative NPV of ${formatter.format(npv)}. The project is not financially viable under these assumptions. ROI: ${roi.toFixed(1)}%.`;
                boxClass += 'bg-red-100 text-red-700 border border-red-300';
            } else {
                message = `The project's NPV is zero. The expected return exactly equals the cost of capital. ROI: 0%.`;
                boxClass += 'bg-yellow-100 text-yellow-700 border border-yellow-300';
            }

            messageBox.className = boxClass;
            messageBox.querySelector('p').textContent = message;
        };

        // Initial setup
        window.onload = () => {
            updateProductName(); // This also calls calculateCBA()
        };

    </script>
</body>
</html>
